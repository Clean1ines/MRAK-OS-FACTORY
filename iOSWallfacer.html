<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>MRAK-OS Workspace | iOS Edition</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    /* iOS Dark Base */
    --bg-main: #000000;
    --bg-canvas: radial-gradient(circle at 50% 50%, #1a1a1e 0%, #000000 100%);
    
    /* iOS Glassmorphism */
    --ios-glass: rgba(28, 28, 30, 0.65);
    --ios-glass-bright: rgba(255, 255, 255, 0.04);
    --ios-glass-dark: rgba(0, 0, 0, 0.4);
    --ios-border: rgba(255, 255, 255, 0.08);
    --ios-border-highlight: rgba(255, 255, 255, 0.12);
    
    /* Bronze/Gold - доработанная палитра */
    --bronze-base: #b8956a;
    --bronze-bright: #d4b48a;
    --bronze-dim: rgba(184, 149, 106, 0.25);
    --bronze-glow: rgba(184, 149, 106, 0.35);
    --bronze-dark: #8a6d4a;
    
    /* Functional Colors */
    --text-main: #f5f5f7;
    --text-muted: #86868b;
    --text-secondary: #a1a1a6;
    --accent-success: #30d158;
    --accent-danger: #ff453a;
    --accent-warning: #ffd60a;
    --accent-info: #0a84ff;
    
    /* Shadows & Effects */
    --shadow-heavy: 0 20px 40px rgba(0,0,0,0.6);
    --shadow-node: 0 8px 24px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.06);
    --shadow-glow: 0 0 30px var(--bronze-glow);
    --blur-std: blur(40px);
    --blur-light: blur(20px);
  }

  * { 
    box-sizing: border-box; 
    margin: 0; padding: 0; 
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    scrollbar-width: thin;
    scrollbar-color: var(--ios-border) transparent;
  }
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-thumb { background: var(--ios-border); border-radius: 3px; }

  body, html {
    width: 100%; height: 100%;
    background-color: var(--bg-main);
    background-image: var(--bg-canvas);
    color: var(--text-main);
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "JetBrains Mono", monospace;
    overflow: hidden;
    user-select: none;
  }

  /* SVG Icons - Clean Lucide Style */
  .icon { 
    width: 18px; height: 18px; 
    stroke: currentColor; 
    fill: none; 
    stroke-width: 1.5; 
    stroke-linecap: round; 
    stroke-linejoin: round;
  }
  .icon-sm { width: 14px; height: 14px; }
  .icon-lg { width: 22px; height: 22px; }

  .interactive { pointer-events: auto; }
  .glass { 
    background: var(--ios-glass); 
    backdrop-filter: var(--blur-std); 
    -webkit-backdrop-filter: var(--blur-std);
    border: 1px solid var(--ios-border); 
  }

  /* 3D Background */
  #three-container {
    position: absolute; inset: 0; z-index: 0;
    pointer-events: none; opacity: 0.5;
  }

  /* Main Shell */
  #mrak-shell {
    position: absolute; inset: 0;
    display: flex; flex-direction: column;
    z-index: 10; pointer-events: none;
  }

  /* Header - iOS Style */
  header {
    height: 60px; display: flex; align-items: center; justify-content: space-between;
    padding: 0 24px; 
    background: rgba(0, 0, 0, 0.5); 
    backdrop-filter: var(--blur-std);
    -webkit-backdrop-filter: var(--blur-std);
    border-bottom: 1px solid var(--ios-border); 
    z-index: 1000;
  }
  .header-brand { display: flex; align-items: center; gap: 12px; }
  .logo { 
    font-size: 1.1rem; font-weight: 700; letter-spacing: 2px; 
    color: var(--bronze-base); 
    text-transform: uppercase; 
    text-shadow: 0 0 20px var(--bronze-glow); 
  }
  .status-pill { 
    font-size: 0.7rem; font-weight: 600; color: var(--text-muted); 
    border: 1px solid var(--ios-border); 
    padding: 5px 12px; border-radius: 20px;
    background: var(--ios-glass-dark); 
    display: flex; align-items: center; gap: 6px;
    transition: all 0.2s ease;
  }
  .status-pill:hover { border-color: var(--bronze-base); color: var(--bronze-bright); }
  .status-pill.active { 
    border-color: var(--accent-success); 
    background: rgba(48, 209, 88, 0.1);
    color: var(--accent-success);
  }
  .status-pill.active::before { 
    content: ''; width: 6px; height: 6px; 
    background: var(--accent-success); 
    border-radius: 50%; 
    box-shadow: 0 0 8px var(--accent-success); 
  }

  /* Workspace */
  .mrak-workspace { flex: 1; display: flex; position: relative; overflow: hidden; }

  /* Sidebars - iOS Style */
  .sidebar {
    width: 280px; 
    background: var(--ios-glass); 
    backdrop-filter: var(--blur-std);
    -webkit-backdrop-filter: var(--blur-std);
    border-right: 1px solid var(--ios-border); 
    display: flex; flex-direction: column;
    padding: 16px 12px; 
    z-index: 500;
  }
  .sidebar.right { 
    width: 360px; 
    border-right: none; 
    border-left: 1px solid var(--ios-border); 
  }

  .sidebar-section { margin-bottom: 24px; }
  .section-label { 
    font-size: 0.65rem; 
    color: var(--text-muted); 
    text-transform: uppercase; 
    letter-spacing: 1.5px; 
    margin-bottom: 12px; 
    font-weight: 600; 
    padding: 0 12px;
    display: flex; justify-content: space-between; align-items: center;
  }
  .section-label .icon { opacity: 0.5; }
  
  .nav-item {
    padding: 10px 12px; 
    font-size: 0.82rem; 
    cursor: pointer; 
    border-radius: 10px;
    display: flex; align-items: center; gap: 10px; 
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    color: var(--text-secondary); 
    border: 1px solid transparent;
  }
  .nav-item:hover { 
    background: var(--ios-glass-bright); 
    color: var(--text-main); 
  }
  .nav-item.active { 
    background: var(--bronze-dim); 
    color: var(--bronze-bright); 
    border: 1px solid var(--bronze-dim); 
  }
  .nav-item .icon { opacity: 0.7; }
  .nav-item.active .icon { opacity: 1; }

  /* Canvas */
  .canvas-wrapper { 
    flex: 1; position: relative; overflow: hidden; 
    background: var(--bg-canvas); 
    cursor: crosshair; 
  }
  #infinite-viewport { 
    position: absolute; width: 100%; height: 100%; 
    transform-origin: 0 0; will-change: transform; 
  }

  .watermark {
    position: absolute; top: 15%; left: 50%; 
    transform: translate(-50%, 0);
    font-size: 4rem; font-weight: 800; 
    color: rgba(184, 149, 106, 0.03);
    letter-spacing: 20px; 
    text-transform: uppercase; 
    pointer-events: none;
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  }

  /* SVG Connections */
  #mrak-svg-layer {
    position: absolute; top: 0; left: 0; width: 20000px; height: 20000px;
    pointer-events: none; z-index: 1;
  }

  /* Nodes - iOS Style */
  .node {
    position: absolute; z-index: 2; 
    min-width: 220px; max-width: 280px;
    background: linear-gradient(145deg, rgba(30,30,32,0.9), rgba(20,20,22,0.95));
    border: 1px solid var(--ios-border); 
    border-top: 1px solid var(--ios-border-highlight);
    border-radius: 14px; 
    padding: 16px; 
    color: var(--text-main); 
    font-size: 0.8rem; 
    font-weight: 500;
    display: flex; flex-direction: column; gap: 10px;
    box-shadow: var(--shadow-node); 
    backdrop-filter: var(--blur-light);
    -webkit-backdrop-filter: var(--blur-light);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: grab; pointer-events: auto;
  }
  .node:active { cursor: grabbing; transform: scale(0.98); }
  .node.active-node { 
    border-color: var(--bronze-base); 
    box-shadow: var(--shadow-node), 0 0 25px var(--bronze-glow); 
  }
  
  .node.core-node { 
    min-width: 280px; 
    background: linear-gradient(145deg, rgba(40,35,25,0.95), rgba(20,20,22,0.95));
    border: 1px solid var(--bronze-dim);
  }
  
  .node-header {
    display: flex; align-items: center; gap: 8px;
    padding-bottom: 8px;
    border-bottom: 1px solid var(--ios-border);
  }
  .node-type { 
    font-size: 0.58rem; 
    color: var(--bronze-base); 
    text-transform: uppercase; 
    font-weight: 700; 
    letter-spacing: 0.8px;
  }
  .node-title { 
    font-size: 0.88rem; 
    font-weight: 600; 
    display: flex; align-items: center; gap: 8px;
    color: var(--text-main);
  }
  .node-title .icon { color: var(--bronze-base); }
  
  .node-content {
    font-size: 0.72rem;
    color: var(--text-secondary);
    line-height: 1.4;
  }
  
  .progress-wrap { 
    width: 100%; height: 3px; 
    background: rgba(0,0,0,0.4); 
    border-radius: 2px; 
    overflow: hidden; 
    border: 1px solid rgba(255,255,255,0.04); 
  }
  .progress-fill { 
    width: 45%; height: 100%; 
    background: linear-gradient(90deg, var(--bronze-dark), var(--bronze-base), var(--bronze-bright));
    box-shadow: 0 0 10px var(--bronze-glow); 
    animation: flow 2.5s infinite ease-in-out; 
    border-radius: 2px;
  }
  @keyframes flow { 
    0% { transform: translateX(-100%); } 
    100% { transform: translateX(300%); } 
  }

  .node-status {
    display: flex; justify-content: space-between; 
    font-size: 0.62rem; 
    color: var(--text-muted);
    font-weight: 500;
  }
  .node-status .ok { color: var(--accent-success); }

  /* Right Sidebar Components */
  .code-viewer {
    background: #0a0a0c; 
    border: 1px solid var(--ios-border); 
    border-left: 3px solid var(--bronze-base);
    border-radius: 10px; 
    padding: 14px; 
    font-family: 'JetBrains Mono', monospace; 
    font-size: 0.72rem; 
    color: var(--text-secondary); 
    margin: 12px 0; 
    line-height: 1.6;
    overflow-x: auto;
  }
  
  .terminal-log {
    flex: 1; 
    overflow-y: auto; 
    display: flex; flex-direction: column; 
    gap: 8px;
    font-family: 'JetBrains Mono', monospace; 
    font-size: 0.68rem;
    padding: 4px;
  }
  .log-entry { 
    padding: 8px 10px; 
    background: var(--ios-glass-dark); 
    border-radius: 8px; 
    border: 1px solid var(--ios-border);
    display: flex; gap: 8px;
  }
  .log-entry .timestamp { color: var(--bronze-dim); font-weight: 600; }
  .log-entry .message { color: var(--text-secondary); }

  .btn-ios { 
    background: var(--ios-glass-bright); 
    border: 1px solid var(--ios-border); 
    color: var(--text-main); 
    padding: 11px 18px; 
    border-radius: 10px; 
    cursor: pointer; 
    font-family: inherit; 
    font-size: 0.75rem; 
    font-weight: 600;
    text-transform: uppercase; 
    letter-spacing: 0.5px; 
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex; align-items: center; justify-content: center; gap: 8px;
    width: 100%;
  }
  .btn-ios:hover { 
    background: var(--ios-glass-bright); 
    border-color: var(--ios-border-highlight);
    transform: translateY(-1px);
  }
  .btn-ios.primary { 
    background: linear-gradient(135deg, var(--bronze-dark), var(--bronze-base)); 
    color: #000; 
    border-color: var(--bronze-bright);
    box-shadow: 0 4px 15px var(--bronze-glow);
  }
  .btn-ios.primary:hover { 
    background: linear-gradient(135deg, var(--bronze-base), var(--bronze-bright));
    box-shadow: 0 6px 20px var(--bronze-glow);
    transform: translateY(-2px);
  }

  /* Bottom Dock - iOS Style */
  .mrak-dock {
    position: absolute; bottom: 28px; left: 50%; 
    transform: translateX(-50%);
    width: 700px; 
    background: var(--ios-glass); 
    backdrop-filter: var(--blur-std);
    -webkit-backdrop-filter: var(--blur-std);
    border-radius: 20px; 
    padding: 16px 20px; 
    border: 1px solid var(--ios-border-highlight);
    display: flex; flex-direction: column; gap: 12px; 
    z-index: 1000;
    box-shadow: var(--shadow-heavy), inset 0 1px 0 rgba(255,255,255,0.06);
    pointer-events: auto;
  }
  .dock-controls { display: flex; gap: 10px; justify-content: center; }
  
  .btn-dock { 
    background: var(--ios-glass-dark); 
    border: 1px solid var(--ios-border); 
    color: var(--text-secondary); 
    padding: 10px 18px; 
    border-radius: 10px; 
    cursor: pointer; 
    font-family: inherit; 
    font-size: 0.72rem; 
    font-weight: 600; 
    transition: all 0.2s ease;
    display: flex; align-items: center; gap: 8px;
    letter-spacing: 0.3px;
  }
  .btn-dock:hover { 
    background: var(--ios-glass-bright); 
    color: var(--text-main);
    border-color: var(--ios-border-highlight);
    transform: translateY(-1px);
  }
  .btn-dock.primary { 
    background: linear-gradient(135deg, var(--bronze-dark), var(--bronze-base)); 
    color: #000; 
    border-color: var(--bronze-bright);
    box-shadow: 0 2px 10px var(--bronze-glow);
  }
  .btn-dock.primary:hover { 
    background: linear-gradient(135deg, var(--bronze-base), var(--bronze-bright));
    box-shadow: 0 4px 15px var(--bronze-glow);
  }
  
  .input-field {
    background: var(--ios-glass-dark); 
    border: 1px solid var(--ios-border);
    border-radius: 12px; 
    padding: 11px 16px; 
    display: flex; align-items: center; 
    gap: 10px;
    transition: all 0.2s ease;
  }
  .input-field:focus-within {
    border-color: var(--bronze-dim);
    background: rgba(0,0,0,0.5);
  }
  .input-field input { 
    background: transparent; 
    border: none; 
    color: var(--text-main); 
    width: 100%; 
    outline: none; 
    font-size: 0.85rem; 
    font-family: inherit; 
  }
  .input-field input::placeholder { color: var(--text-muted); }
  .input-field .send-btn { 
    cursor: pointer; 
    color: var(--bronze-base); 
    transition: all 0.2s;
    padding: 4px;
    border-radius: 6px;
  }
  .input-field .send-btn:hover { 
    background: var(--bronze-dim);
    color: var(--bronze-bright);
    transform: translateX(2px);
  }

  .dock-info {
    display: flex; justify-content: space-between; 
    font-size: 0.65rem; 
    color: var(--text-muted); 
    font-weight: 500;
    padding: 0 4px;
  }
  .dock-info b { color: var(--bronze-base); }

  .brand-footer { 
    position: absolute; bottom: 12px; left: 24px; 
    font-size: 0.62rem; 
    color: var(--text-muted); 
    font-weight: 600; 
    letter-spacing: 1.5px; 
    text-transform: uppercase;
  }
  .brand-footer span { color: var(--bronze-base); }
</style>
</head>
<body>

<div id="three-container"></div>

<div id="mrak-shell">
  <header class="interactive">
    <div class="header-brand">
      <div class="logo">MRAK-OS</div>
      <div class="status-pill active">System Active</div>
    </div>
    <div style="display: flex; gap: 10px;">
      <div class="status-pill">
        <svg class="icon icon-sm" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        4ms
      </div>
      <div class="status-pill" style="border-color:var(--bronze-dim); color:var(--bronze-bright);">
        <svg class="icon icon-sm" viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
        Encrypted
      </div>
    </div>
  </header>

  <div class="mrak-workspace">
    <aside class="sidebar interactive">
      <div class="sidebar-section">
        <div class="section-label">
          Projects
          <svg class="icon icon-sm" viewBox="0 0 24 24"><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></svg>
        </div>
        <div class="nav-item active">
          <svg class="icon" viewBox="0 0 24 24"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>
          Software Dev
        </div>
        <div class="nav-item">
          <svg class="icon" viewBox="0 0 24 24"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>
          AI Research
        </div>
        <div class="nav-item">
          <svg class="icon" viewBox="0 0 24 24"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>
          Infra Core
        </div>
      </div>

      <div class="sidebar-section">
        <div class="section-label">
          Workflows
          <svg class="icon icon-sm" viewBox="0 0 24 24"><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></svg>
        </div>
        <div class="nav-item active">
          <svg class="icon" viewBox="0 0 24 24"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
          Software Dev v4
        </div>
        <div class="nav-item" style="color:var(--bronze-bright); border-color:var(--bronze-dim);">
          <svg class="icon" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
          New Workflow
        </div>
      </div>

      <div class="sidebar-section">
        <div class="section-label">Prompts Library</div>
        <div class="nav-item">
          <svg class="icon" viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
          Senior AI Assistant
        </div>
        <div class="nav-item">
          <svg class="icon" viewBox="0 0 24 24"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
          Meta Engineer
        </div>
        <div class="nav-item">
          <svg class="icon" viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
          Validator
        </div>
      </div>

      <div style="flex:1"></div>
      <button class="btn-ios">
        <svg class="icon" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        New Project
      </button>
    </aside>

    <main class="canvas-wrapper interactive" id="canvas-main">
      <div class="watermark">CRAFT IN SILENCE</div>
      <div id="infinite-viewport">
        <svg id="mrak-svg-layer">
          <defs>
            <filter id="glow-line" x="-20%" y="-20%" width="140%" height="140%">
              <feGaussianBlur stdDeviation="2" result="blur"/>
              <feMerge>
                <feMergeNode in="blur"/>
                <feMergeNode in="SourceGraphic"/>
              </feMerge>
            </filter>
            <marker id="mrak-arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
              <polygon points="0 0, 10 3.5, 0 7" fill="var(--bronze-base)" />
            </marker>
          </defs>
        </svg>

        <div class="node active-node core-node" id="node-main-engine" style="left: 450px; top: 350px;">
          <div class="node-header">
            <span class="node-type">System Central</span>
          </div>
          <div class="node-title">
            <svg class="icon" viewBox="0 0 24 24"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
            Neural Processor
          </div>
          <div class="progress-wrap"><div class="progress-fill"></div></div>
          <div class="node-status">
            <span>Load: 42%</span>
            <span class="ok">● Online</span>
          </div>
        </div>

        <div class="node" id="node-logic-1" style="left: 150px; top: 200px;">
          <div class="node-header">
            <span class="node-type">Input</span>
          </div>
          <div class="node-title">
            <svg class="icon" viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
            Idea Ingest
          </div>
          <div class="node-content">Waiting for signal...</div>
        </div>

        <div class="node" id="node-logic-2" style="left: 850px; top: 250px;">
          <div class="node-header">
            <span class="node-type">Logic</span>
          </div>
          <div class="node-title">
            <svg class="icon" viewBox="0 0 24 24"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
            Code Weaver
          </div>
          <div class="node-content">Refactoring v2.1...</div>
        </div>

        <div class="node" id="node-archive" style="left: 850px; top: 500px; opacity:0.6;">
          <div class="node-header">
            <span class="node-type">Storage</span>
          </div>
          <div class="node-title">
            <svg class="icon" viewBox="0 0 24 24"><path d="M21 8v13H3V8"/><path d="M1 3h22v5H1z"/><path d="M10 12h4"/></svg>
            Vault State
          </div>
        </div>
      </div>
    </main>

    <aside class="sidebar right interactive">
      <div class="section-label">System Logs</div>
      <div class="terminal-log" id="mrak-logger">
        <div class="log-entry">
          <span class="timestamp">11:22:01</span>
          <span class="message">Kernel initialized successfully</span>
        </div>
        <div class="log-entry">
          <span class="timestamp">11:22:04</span>
          <span class="message">Viewport matrix updated: Zoom 1.0</span>
        </div>
        <div class="log-entry">
          <span class="timestamp">11:22:10</span>
          <span class="message">Connection established: Node-Main → Node-Logic</span>
        </div>
      </div>

      <div class="section-label">Node Configuration</div>
      <div class="code-viewer">
        export interface Node {<br>
        &nbsp;&nbsp;id: string;<br>
        &nbsp;&nbsp;type: NodeType;<br>
        &nbsp;&nbsp;position: Vector2;<br>
        &nbsp;&nbsp;prompt: SystemPrompt;<br>
        }
      </div>
      
      <button class="btn-ios primary">
        <svg class="icon" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
        Commit Changes
      </button>
      
      <div class="section-label">Version History</div>
      <div class="nav-item active" style="justify-content:space-between">
        <span>v4.0 Current</span>
        <span style="font-size:0.6rem; border:1px solid var(--bronze-dim); padding:2px 6px; border-radius:4px;">Live</span>
      </div>
      <div class="nav-item">
        <span>v3.2 Previous</span>
      </div>
      <div class="nav-item">
        <span>v3.0 Initial</span>
      </div>
    </aside>
  </div>

  <div class="mrak-dock interactive">
    <div class="dock-controls">
      <button class="btn-dock primary">
        <svg class="icon" viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"/></svg>
        Execute
      </button>
      <button class="btn-dock">
        <svg class="icon" viewBox="0 0 24 24"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
        Pause
      </button>
      <button class="btn-dock">
        <svg class="icon" viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
        Refine
      </button>
    </div>
    <div class="input-field">
      <input type="text" placeholder="Enter command...">
      <svg class="icon send-btn" viewBox="0 0 24 24"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
    </div>
    <div class="dock-info">
      <span>Target: <b>NEURAL_PROCESSOR</b></span>
      <span>Matrix: <b id="debug-scale">1.0x</b> | <b id="debug-pan">0,0</b></span>
    </div>
  </div>

  <div class="brand-footer">Made in <span>MRAK</span></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.min.js"></script>
<script>
/**
 * MRAK-OS CANVAS ENGINE v5.0 iOS Edition
 */
class MrakCanvas {
    constructor() {
        this.viewport = document.getElementById('infinite-viewport');
        this.canvasRoot = document.getElementById('canvas-main');
        this.svgLayer = document.getElementById('mrak-svg-layer');
        this.logger = document.getElementById('mrak-logger');
        
        this.state = {
            pan: { x: window.innerWidth / 2 - 500, y: window.innerHeight / 2 - 300 },
            scale: 0.9,
            isPanning: false,
            draggedNode: null,
            mouseStart: { x: 0, y: 0 },
            nodes: [
                { id: 'node-main-engine', x: 450, y: 350, active: true },
                { id: 'node-logic-1', x: 150, y: 200, active: false },
                { id: 'node-logic-2', x: 850, y: 250, active: false },
                { id: 'node-archive', x: 850, y: 500, active: false }
            ],
            links: [
                { from: 'node-logic-1', to: 'node-main-engine' },
                { from: 'node-main-engine', to: 'node-logic-2' },
                { from: 'node-main-engine', to: 'node-archive' }
            ]
        };

        this.init();
    }

    log(msg) {
        const time = new Date().toLocaleTimeString([], { hour12: false });
        const entry = document.createElement('div');
        entry.className = 'log-entry';
        entry.innerHTML = `<span class="timestamp">${time}</span><span class="message">${msg}</span>`;
        this.logger.prepend(entry);
        if (this.logger.children.length > 20) this.logger.lastChild.remove();
    }

    updateTransform() {
        this.viewport.style.transform = `translate(${this.state.pan.x}px, ${this.state.pan.y}px) scale(${this.state.scale})`;
        document.getElementById('debug-scale').innerText = this.state.scale.toFixed(2);
        document.getElementById('debug-pan').innerText = `${Math.round(this.state.pan.x)},${Math.round(this.state.pan.y)}`;
        this.renderConnections();
    }

    renderConnections() {
        const defs = this.svgLayer.querySelector('defs');
        this.svgLayer.innerHTML = '';
        this.svgLayer.appendChild(defs);

        this.state.links.forEach(link => {
            const from = this.state.nodes.find(n => n.id === link.from);
            const to = this.state.nodes.find(n => n.id === link.to);
            if (!from || !to) return;

            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            const x1 = from.x + 140, y1 = from.y + 50;
            const x2 = to.x, y2 = to.y + 50;
            
            const cp1x = x1 + (x2 - x1) * 0.5;
            const d = `M ${x1} ${y1} C ${cp1x} ${y1}, ${cp1x} ${y2}, ${x2} ${y2}`;
            
            path.setAttribute('d', d);
            path.setAttribute('stroke', from.active || to.active ? 'var(--bronze-base)' : 'rgba(184, 149, 106, 0.2)');
            path.setAttribute('stroke-width', '1.5');
            path.setAttribute('fill', 'none');
            path.setAttribute('filter', 'url(#glow-line)');
            path.setAttribute('marker-end', 'url(#mrak-arrow)');
            this.svgLayer.appendChild(path);
        });
    }

    init() {
        // Zoom
        this.canvasRoot.addEventListener('wheel', e => {
            e.preventDefault();
            const factor = Math.pow(1.12, -e.deltaY / 300);
            const newScale = Math.min(Math.max(this.state.scale * factor, 0.2), 3);
            
            const rect = this.canvasRoot.getBoundingClientRect();
            const mx = e.clientX - rect.left;
            const my = e.clientY - rect.top;

            this.state.pan.x = mx - (mx - this.state.pan.x) * (newScale / this.state.scale);
            this.state.pan.y = my - (my - this.state.pan.y) * (newScale / this.state.scale);
            this.state.scale = newScale;
            this.updateTransform();
        }, { passive: false });

        // Pan (Alt + Click or Middle Mouse)
        this.canvasRoot.addEventListener('mousedown', e => {
            if (e.button === 1 || (e.button === 0 && e.altKey)) {
                this.state.isPanning = true;
                this.state.mouseStart.x = e.clientX - this.state.pan.x;
                this.state.mouseStart.y = e.clientY - this.state.pan.y;
                this.canvasRoot.style.cursor = 'grabbing';
            }
        });

        // Node Drag
        document.querySelectorAll('.node').forEach(el => {
            el.addEventListener('mousedown', e => {
                if (e.button !== 0 || e.altKey) return;
                e.stopPropagation();
                this.state.draggedNode = this.state.nodes.find(n => n.id === el.id);
                this.state.mouseStart.nodeX = (e.clientX / this.state.scale) - this.state.draggedNode.x;
                this.state.mouseStart.nodeY = (e.clientY / this.state.scale) - this.state.draggedNode.y;
                el.classList.add('active-node');
                this.log(`Dragging node: ${this.state.draggedNode.id}`);
            });
        });

        window.addEventListener('mousemove', e => {
            if (this.state.isPanning) {
                this.state.pan.x = e.clientX - this.state.mouseStart.x;
                this.state.pan.y = e.clientY - this.state.mouseStart.y;
                this.updateTransform();
            } else if (this.state.draggedNode) {
                this.state.draggedNode.x = (e.clientX / this.state.scale) - this.state.mouseStart.nodeX;
                this.state.draggedNode.y = (e.clientY / this.state.scale) - this.state.mouseStart.nodeY;
                const el = document.getElementById(this.state.draggedNode.id);
                el.style.left = this.state.draggedNode.x + 'px';
                el.style.top = this.state.draggedNode.y + 'px';
                this.renderConnections();
            }
        });

        window.addEventListener('mouseup', () => {
            if (this.state.draggedNode) {
                document.getElementById(this.state.draggedNode.id).classList.remove('active-node');
                this.log(`Node dropped: ${Math.round(this.state.draggedNode.x)}, ${Math.round(this.state.draggedNode.y)}`);
                localStorage.setItem('mrak-nodes', JSON.stringify(this.state.nodes));
            }
            this.state.isPanning = false;
            this.state.draggedNode = null;
            this.canvasRoot.style.cursor = 'crosshair';
        });

        // Hover Animation
        const runAnim = (t) => {
            this.state.nodes.forEach(node => {
                if (node.active && !this.state.draggedNode) {
                    const el = document.getElementById(node.id);
                    const hover = Math.sin(t * 0.0015) * 8;
                    el.style.transform = `translate3d(0, ${hover}px, 0)`;
                }
            });
            requestAnimationFrame(runAnim);
        };
        runAnim(0);

        // Load saved positions
        const saved = localStorage.getItem('mrak-nodes');
        if (saved) {
            const nodes = JSON.parse(saved);
            nodes.forEach(n => {
                const el = document.getElementById(n.id);
                if (el) {
                    el.style.left = n.x + 'px';
                    el.style.top = n.y + 'px';
                }
            });
            this.state.nodes = nodes;
        }

        this.updateTransform();
    }
}

/**
 * THREE.JS BACKGROUND - Bronze Particles
 */
const initStars = () => {
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 1, 2000);
    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.getElementById('three-container').appendChild(renderer.domElement);

    const geo = new THREE.BufferGeometry();
    const pos = [];
    for(let i=0; i<3000; i++) {
        pos.push(
            THREE.MathUtils.randFloatSpread(2000),
            THREE.MathUtils.randFloatSpread(2000),
            THREE.MathUtils.randFloatSpread(2000)
        );
    }
    geo.setAttribute('position', new THREE.Float32BufferAttribute(pos, 3));
    
    const mat = new THREE.PointsMaterial({ 
        color: 0xb8956a, 
        size: 1.5, 
        transparent: true, 
        opacity: 0.35,
        sizeAttenuation: true
    });
    const cloud = new THREE.Points(geo, mat);
    scene.add(cloud);
    camera.position.z = 800;

    const anim = () => {
        requestAnimationFrame(anim);
        cloud.rotation.y += 0.0003;
        cloud.rotation.x += 0.0001;
        renderer.render(scene, camera);
    };
    anim();
    
    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });
};

// Start Systems
document.addEventListener('DOMContentLoaded', () => {
    window.Engine = new MrakCanvas();
    initStars();
    console.log("MRAK-OS iOS Kernel Loaded.");
});
</script>
</body>
</html>