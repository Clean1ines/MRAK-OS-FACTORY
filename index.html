<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Made in MRAK</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        * { font-family: 'JetBrains Mono', monospace; }

        body { background: radial-gradient(circle at center, #031015 0%, #010509 60%, #000000 100%); }

        nav { background: rgba(3, 15, 22, 0.75); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(0, 255, 255, 0.08); }

        select, input, textarea { background: rgba(0, 20, 28, 0.7); border: 1px solid rgba(0, 255, 255, 0.15); border-radius: 8px; color: #d9feff; padding: 6px 10px; transition: all 0.2s ease; }
        select:focus, input:focus, textarea:focus { outline: none; border-color: rgba(0, 255, 255, 0.6); box-shadow: 0 0 15px rgba(0, 255, 255, 0.4); }

        button { background: rgba(0, 30, 45, 0.6); border: 1px solid rgba(0,255,255,0.2); color: #7afcff; border-radius: 10px; padding: 6px 14px; transition: all 0.2s ease; }
        button:hover { background: rgba(0,255,255,0.15); box-shadow: 0 0 18px rgba(0,255,255,0.6); }

        #messages { background: rgba(0, 18, 25, 0.6); border-radius: 20px; border: 1px solid rgba(0,255,255,0.15); padding: 40px; box-shadow: 0 0 50px rgba(0,255,255,0.08), inset 0 0 30px rgba(0,255,255,0.05); }

        textarea::placeholder { color: rgba(0, 255, 255, 0.4); }

        /* =================== –í–ò–ó–£–ê–õ–¨–ù–´–ï –≠–§–§–ï–ö–¢–´ =================== */
        .glow { text-shadow: 0 0 4px #0ff, 0 0 10px #0ff; }
        .cursor::after { content: "‚ñã"; animation: blink 1s infinite; margin-left: 4px; }
        @keyframes blink { 0%,50%,100% {opacity:1;} 25%,75% {opacity:0;} }

        /* CRT overlay */
        body::before {
            content: '';
            position: fixed; top:0; left:0; right:0; bottom:0;
            pointer-events: none;
            background: repeating-linear-gradient(rgba(0,0,0,0.05) 0 2px, transparent 2px 4px);
            mix-blend-mode: overlay;
            z-index: 9999;
        }
        body::after {
            content: '';
            position: fixed; top:0; left:0; right:0; bottom:0;
            pointer-events: none;
            background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYdAAAADUlEQVQIW2NkYGD4DwABBAEAfKjX6wAAAABJRU5ErkJggg==') repeat;
            opacity: 0.03; mix-blend-mode: overlay;
            z-index: 9999;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞ */
        .progress-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            padding: 10px 0;
        }
        .progress-step {
            flex: 1;
            text-align: center;
            font-size: 0.9rem;
            color: #0ff;
            opacity: 0.5;
            transition: opacity 0.3s;
            border-bottom: 2px solid rgba(0,255,255,0.2);
            padding-bottom: 5px;
        }
        .progress-step.active {
            opacity: 1;
            border-bottom-color: #0ff;
            font-weight: bold;
        }
        .progress-step.completed {
            opacity: 0.8;
            color: #6f6;
        }
    </style>
</head>

<body class="h-screen flex flex-col antialiased overflow-hidden text-cyan-100">

    <!-- NAV -->
    <nav class="h-14 flex items-center justify-between px-6 shrink-0">
        <div class="flex items-center gap-6">
            <div class="flex flex-col">
                <span class="text-[8px] tracking-widest text-cyan-400 uppercase">Prompt_Mode</span>
                <select id="mode-select">
                    <option>Loading...</option>
                </select>
            </div>
            <div class="flex flex-col">
                <span class="text-[8px] tracking-widest text-cyan-400 uppercase">Neural_Model</span>
                <select id="model-select">
                    <option>Loading...</option>
                </select>
            </div>
        </div>
        <div class="flex gap-4 text-xs text-cyan-500">
            <span>TOKENS: <b id="q-tokens">---</b></span>
            <span>REQ: <b id="q-req">---</b></span>
        </div>
    </nav>

    <!-- STATUS -->
    <div class="px-6 py-2 border-b border-white/5 text-xs flex justify-between">
        <span id="status-text">Craft in Silence</span>
        <span id="token-count">EST_COST: 0</span>
    </div>

    <!-- PROJECT PANEL -->
    <div class="px-6 py-3 border-b border-white/5 flex flex-wrap items-center gap-4 shrink-0">
        <div class="flex items-center gap-2">
            <span class="text-sm text-cyan-400">–ü—Ä–æ–µ–∫—Ç:</span>
            <select id="project-select">
                <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ --</option>
            </select>
            <button id="new-project-btn">–ù–æ–≤—ã–π</button>
            <button id="delete-project-btn">–£–¥–∞–ª–∏—Ç—å</button>
        </div>
        <div class="flex items-center gap-2 ml-auto">
            <span class="text-sm text-cyan-400">–†–µ–∂–∏–º:</span>
            <button id="simple-mode-btn">–ü—Ä–æ—Å—Ç–æ–π</button>
            <button id="advanced-mode-btn">–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π</button>
        </div>
    </div>

    <!-- –ü–†–û–ì–†–ï–°–°-–ë–ê–† -->
    <div id="progress-bar-container" class="px-6 py-2 hidden">
        <div class="progress-bar" id="progress-bar">
            <div class="progress-step" data-step="idea">–ò–¥–µ—è</div>
            <div class="progress-step" data-step="requirements">–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è</div>
            <div class="progress-step" data-step="architecture">–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</div>
            <div class="progress-step" data-step="code">–ö–æ–¥</div>
            <div class="progress-step" data-step="tests">–¢–µ—Å—Ç—ã</div>
        </div>
    </div>

    <!-- –†–ê–°–®–ò–†–ï–ù–ù–´–ï –ö–û–ù–¢–†–û–õ–´ -->
    <div id="advanced-controls" class="px-6 py-2 flex flex-wrap items-center gap-4 advanced-only">
        <div class="flex items-center gap-2">
            <span class="text-sm text-cyan-400">–¢–∏–ø:</span>
            <select id="artifact-type-select">
                <option value="BusinessIdea">–ë–∏–∑–Ω–µ—Å-–∏–¥–µ—è</option>
                <option value="ProductCouncilAnalysis">–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–¥—É–∫—Ç–æ–≤–æ–≥–æ —Å–æ–≤–µ—Ç–∞</option>
                <option value="BusinessRequirementPackage">–ü–∞–∫–µ—Ç –±–∏–∑–Ω–µ—Å-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π</option>
                <option value="ReqEngineeringAnalysis">–ê–Ω–∞–ª–∏–∑ –∏–Ω–∂–µ–Ω–µ—Ä–∏–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π</option>
                <option value="FunctionalRequirementPackage">–ü–∞–∫–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π</option>
                <option value="CodeArtifact">–ö–æ–¥</option>
            </select>
        </div>
        <div class="flex items-center gap-2">
            <span class="text-sm text-cyan-400">–†–æ–¥–∏—Ç–µ–ª—å:</span>
            <select id="parent-select">
                <option value="">-- –Ω–µ—Ç --</option>
            </select>
            <button id="refresh-parents">‚ü≤</button>
            <button id="delete-artifact-btn">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π</button>
        </div>
        <button id="generate-artifact-btn" style="display:none;">–°–æ–∑–¥–∞—Ç—å/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
        <button id="save-artifact-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç</button>
    </div>

    <!-- –ü–†–û–°–¢–û–ô –ö–û–ù–¢–†–û–õ–¨ -->
    <div id="simple-controls" class="px-6 py-2 hidden">
        <button id="next-btn">–î–∞–ª–µ–µ</button>
    </div>

    <!-- TERMINAL -->
    <main class="flex-1 overflow-y-auto px-6 py-6">
        <div id="messages" class="max-w-3xl w-full mx-auto space-y-8"></div>
        <!-- ADDED: —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è —Å–∫—Ä–æ–ª–ª–∞ -->
        <div id="scroll-anchor" class="h-32"></div>
    </main>

    <!-- INPUT -->
    <footer class="p-6 shrink-0 bg-gradient-to-t from-black to-transparent">
        <div class="max-w-3xl mx-auto">
            <div class="flex items-end gap-3 bg-[#111113] border border-white/10 rounded-2xl p-3 focus-within:border-cyan-400 transition-all">
                <textarea id="input" rows="1" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å..." class="flex-1 bg-transparent border-none resize-none outline-none text-cyan-100"></textarea>
                <button id="send-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </footer>

    <script src="api.js"></script>
    <script src="state.js"></script>
    <script src="ui.js"></script>
    <script src="simpleMode.js"></script>
    <script src="main.js"></script>
</body>
</html>
